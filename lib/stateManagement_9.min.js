class Observe_Charts_state{constructor(){this.legends_array=[]}observe_chart_state(e,t){var a,s="",l="",i="",r="",n="",_="",d="",c="",g=(this.legends_array,this);setInterval(function(){try{if(_=e.list_idx_segment_single_selected.join(),c=e.list_idx_segments_multiples_selected.join(),d=Object.values(e.brush_values).join(),s!==_)if(""!==_){sharedParams.time_refresh=new Date;var f="selection_binding";g.set_filter(e,t,f),s=e.list_idx_segment_single_selected.join(),e.status_chart="",l="",sharedParams.time_refresh=(new Date-sharedParams.time_refresh)/1e3,console.log(sharedParams.time_refresh)}else if(""===_){f="selection_binding";sharedParams.time_refresh=new Date,g.remove_filter(e,t,f),s=e.list_idx_segment_single_selected.join(),e.status_chart="",l="",sharedParams.time_refresh=(new Date-sharedParams.time_refresh)/1e3,console.log(sharedParams.time_refresh)}}catch(e){console.log("observer 1 ko:"+e.stack)}try{if(""===s&&l!==c)if(""!==c){sharedParams.time_refresh=new Date,l=e.list_idx_segments_multiples_selected.join();f="multiple_selection_binding";g.set_filter(e,t,f),sharedParams.time_refresh=(new Date-sharedParams.time_refresh)/1e3,console.log(sharedParams.time_refresh)}else if(""===c){sharedParams.time_refresh=new Date;f="multiple_selection_binding";g.remove_filter(e,t,f),l=e.list_idx_segments_multiples_selected.join(),e.status_chart="",sharedParams.time_refresh=(new Date-sharedParams.time_refresh)/1e3,console.log(sharedParams.time_refresh)}}catch(e){console.log("observer 2 ko: "+e.stack)}if(i!==d)if(""!==d){sharedParams.time_refresh=new Date;f="brush_selection_binding";g.set_filter(e,t,f),i=Object.values(e.brush_values).join(),e.status_chart="",sharedParams.time_refresh=(new Date-sharedParams.time_refresh)/1e3,console.log(sharedParams.time_refresh)}else if(""===d){f="brush_selection_binding";sharedParams.time_refresh=new Date,g.remove_filter(e,t,f),i=Object.values(e.brush_values).join(),e.status_chart="",sharedParams.time_refresh=(new Date-sharedParams.time_refresh)/1e3,console.log(sharedParams.time_refresh)}try{e.chart_type;var h=(b=collect_active_legends(a=e.chart_instance,g,e)).active_legends,o=b.hidden_legends;if("leaflet"!==e.chart_type){var u=function(e){for(var t=e.legend.legendItems.length,a=[],s=0;s<t;s++){var l=e.legend.legendItems[s].hidden;!0===l&&a.push(l)}return a}(a);u=deduplicate_array(u)}else o=[];if(void 0!==h&&(r=[...h].join()),!0===e.legend_clicked&&n!==r){console.log("legend clicked on "+e.id+": "+h);var b;h=(b=collect_active_legends(a,g,e)).active_legends,o=b.hidden_legends;if(void 0!==h&&(n=[...h].join()),"leaflet"!==e.chart_type)e.chart_instance.config.type;"leaflet"!==e.chart_type?1===e.nb_axis?e.active_legends={[e.category_field]:h}:2===e.nb_axis&&(e.active_legends={[e.sub_category_field]:h}):"leaflet"===e.chart_type&&(e.active_legends={[e.legends_field]:h}),1===e.nb_axis?e.hidden_legends={[e.category_field]:o}:2===e.nb_axis&&(e.hidden_legends={[e.sub_category_field]:o}),sharedParams.time_refresh=new Date;f="legends_binding";g.set_filter(e,t,f),e.legend_clicked=!1,sharedParams.time_refresh=(new Date-sharedParams.time_refresh)/1e3,console.log(sharedParams.time_refresh)}}catch(e){console.log("observer legends ko: "+e.stack)}},20)}set_filter(e,t,a){var s,l=t.filter(e=>!0===e.filter).map(e=>e.chart),i={};e.status_chart="active";for(var r=0;r<l.length;r++){var n=l[r];n.status_chart="target";var d={};if(Object.values(e.hidden_legends).length>0)var c=Object.values(e.hidden_legends)[0].length;else c=0;if(Object.values(n.hidden_legends).length>0)var g=Object.values(n.hidden_legends)[0].length;else g=0;if(e.legends_field===n.legends_field&&(c>0||g>0)&&"legends_binding"===a)sync_legends(e,n,l);else if("selection_binding"===a||"multiple_selection_binding"===a){if("selection_binding"===a)var f=_.cloneDeep(e.list_labels_segment_single_selected);else if("multiple_selection_binding"===a)f=_.cloneDeep(e.list_labels_segments_multiples_selected);0===f.filter(e=>""!==e.category_field).length?(d[e.sub_category_field]=[],f.map(e=>delete e.category_field),f.map(t=>{d[e.sub_category_field].push(t.sub_category_field)})):0===f.filter(e=>""!==e.sub_category_field).length?(d[e.category_field]=[],f.map(e=>delete e.sub_category_field),f.map(t=>{d[e.category_field].push(t.category_field)})):(d[e.category_field]=[],d[e.sub_category_field]=[],f.map(t=>{d[e.category_field].push(t.category_field),d[e.sub_category_field].push(t.sub_category_field)}))}else"brush_selection_binding"===a?Object.assign(d,e.brush_keys_values):"legends_binding"===a&&(1===e.nb_axis?void 0!==e.sub_category_field?d[e.sub_category_field]=[...this.legends_array]:void 0!==e.category_field&&("leaflet"!==e.chart_type?d[e.category_field]=[...this.legends_array]:d[e.legends_field]=[...this.legends_array]):2===e.nb_axis&&(d[e.sub_category_field]=[...this.legends_array]));for(var h=t.filter(e=>!0===e.collect_active_slices).map(e=>e.chart),o=0;o<h.length;o++)if("target"!==h[o].status_chart){var u=h[o];if("selection_binding"===a)if(u.list_keys_values_segments_multiples_selected.length>=1)extract_active_slices(u,d);else if(Object.values(u.brush_keys_values).length>0){var b=_.mapValues(u.brush_keys_values,function(e,t){return e});Object.assign(d,b),Object.assign(i,b)}else[];else if("multiple_selection_binding"===a||"legends_binding"===a){u.hidden_legends;if(u.list_keys_values_segments_multiples_selected.length>=1)extract_active_slices(u,d);else if(Object.values(u.brush_keys_values).length>0){b=_.mapValues(u.brush_keys_values,function(e,t){return e});Object.assign(d,b),Object.assign(i,b)}else[]}else if("brush_selection_binding"===a){var y={};Object.assign(y,u.brush_keys_values),Object.keys(d).map(e=>delete y[e]),Object.assign(d,y),Object.assign(i,y),extract_active_slices(u,d)}}clean_filter_array(d),collect_active_legends_setFilter(e,n,h,d,a);var v="set_filter";if(clean_filter_array(d),Object.keys(d).length>0)n.filtered_by={},w(e,n,d,v),Object.assign(i,d);else try{delete n.filtered_by.axis[e.category_field],delete n.filtered_by.axis[e.sub_category_field]}catch{}n.status_chart=""}var p={};Object.keys(i).forEach(e=>{""!==i[e][0]&&(p[e]=i[e])}),delete p[""],i=_.cloneDeep(p);for(var m=0;m<l.length;m++){var j=l[m],O=_.mapKeys(j.filtered_by.axis,function(e,t){return t});clean_filter_array(O);var x=Object.keys(O);if(x=x.filter(e=>""!==e),"leaflet"!==j.chart_type){var k={};l.map(e=>{"leaflet"!==e.chart_type&&(k[e.legends_field]=e.chart_instance.legend.legendItems.filter(e=>""!==e.text&&!1===e.hidden).map(e=>e.text))}),"leaflet"===e.chart_type||(k[e.legends_field]=e.chart_instance.legend.legendItems.filter(e=>""!==e.text&&!1===e.hidden).map(e=>e.text))}var P={},D=!1;if(I(O,k,P),!0===D)clean_filter_array(P),w(j,j,P,v="set_filter"),D=!1}v="set_filter";function I(e,t,a){Object.keys(e).forEach(s=>{e[s].findIndex(e=>""===e)>-1&&(delete e[s],e[s]=t[s],Object.assign(a,e),D=!0)})}function w(e,t,a,s){t.transformations.crossfilter={},Object.assign(t.transformations.crossfilter,a),t.filtered_by={id:e.id,params_chart:e,axis:a};var l,i=t.instanciator.prepare_data_p1(t);if(l="leaflet"===t.chart_type?t.map_instance:t.chart_instance,t.data[0].labels=[],t.data[1].datasets=[],"leaflet"!==t.chart_type){l.config.data.labels=[];for(var r=0;r<l.config.data.datasets.length;r++)l.config.data.datasets[r].data=[],l.config.data.datasets[r].label="",l.config.data.datasets[r].backgroundColor=[],l.config.data.datasets[r].borderColor=[],l.config.data.datasets[r].borderWidth=[]}else t.data[1].markers=[],t.data[1].x_y=[],t.inject_type="update";if(0!==t.list_labels_segment_single_selected.length||0!==t.list_labels_segments_multiples_selected.length||Object.values(t.brush_values).length>0){t.prepare_data_type="preserve backgroundColor",t.instanciator.prepare_data_p2(i,t);var n="data",_="update";t.instanciator.inject_metadata(l,t,n,_),t.prepare_data_type="","leaflet"!==t.chart_type?hide_legends(t,"set_filter"):t.instanciator.setup_legends(t,"update")}else{t.prepare_data_type="",t.instanciator.prepare_data_p2(i,t);n="data",_="update";t.instanciator.inject_metadata(l,t,n,_),"leaflet"!==t.chart_type?hide_legends(t,"set_filter"):t.instanciator.setup_legends(t,"update")}}P={},s={},void 0===e.filtered_by.axis||I(e.filtered_by.axis,k,P),Object.assign(s,e.filtered_by.axis),clean_filter_array(s),Object.values(s).length>0&&"leaflet"!==e.chart_type&&w(e,e,e.filtered_by.axis,v)}remove_filter(e,t,a){for(var s={},l=t.filter(e=>!0===e.filter).map(e=>e.chart),i=t.filter(e=>!0===e.collect_active_slices).map(e=>e.chart),r=0;r<l.length;r++){var n=l[r];n.has_been_filtred=!1,n.to_filter=void 0,e.status_chart="active",n.status_chart="target";for(var d={},c=0;c<i.length;c++)if("target"!==i[c].status_chart){var g=i[c],f=[];if("selection_binding"===a){if(g.list_labels_segments_multiples_selected.length>=1)extract_active_slices(g,d),extract_active_slices(g,s);else if(Object.values(g.brush_keys_values).length>0){var h=_.mapValues(g.brush_keys_values,function(e,t){return e});Object.assign(d,h),Object.assign(s,h)}else f=[];if(f.length>0){d[g.category_field]=[],s[g.category_field]=[],d[g.sub_category_field]=[],s[g.sub_category_field]=[];for(var o=0;o<f.length;o++){var u=f[o];1===Object.keys(u).length?(d[g.category_field].push(u.category_field),s[g.category_field].push(u.category_field)):2===Object.keys(u).length&&(d[g.category_field].push(u.category_field),d[g.sub_category_field].push(u.sub_category_field),s[g.category_field].push(u.category_field),s[g.sub_category_field].push(u.sub_category_field))}}}else if("multiple_selection_binding"===a){if(g.list_labels_segments_multiples_selected.length>=1)extract_active_slices(g,d),extract_active_slices(g,s);else if(Object.values(g.brush_keys_values).length>0){h=_.mapValues(g.brush_keys_values,function(e,t){return e});Object.assign(d,h),Object.assign(s,h)}else f=[];if(f.length>0){var b=[],y=[];for(o=0;o<f.length;o++){u=f[o];1===Object.keys(u).length?b.push(u.category_field):2===Object.keys(u).length&&(b.push(u.category_field),y.push(u.sub_category_field))}1===Object.keys(u).length?(d[g.category_field]=b,s[g.category_field]=b):2===Object.keys(u).length&&(d[g.category_field]=b,d[g.sub_category_field]=y,s[g.category_field]=b,s[g.sub_category_field]=y)}}else if("brush_selection_binding"===a){var v={};Object.assign(v,g.brush_keys_values),Object.keys(d).map(e=>delete v[e]),Object.assign(d,v),Object.assign(s,v),extract_active_slices(g,d),extract_active_slices(g,s)}}if(Object.values(e.hidden_legends).length>0)var p=Object.values(e.hidden_legends)[0].length;else p=0;if(Object.values(n.hidden_legends).length>0)var m=Object.values(n.hidden_legends)[0].length;else m=0;if(clean_filter_array(d),e.legends_field===n.legends_field&&p>0&&!1===d.hasOwnProperty(e.legends_field)?sync_legends_rm_filter(e,n):m>0?!1===d.hasOwnProperty(n.legends_field)&&0===n.list_keys_values_segments_multiples_selected.length?restore_original_chart_datasets(n):0===n.list_keys_values_segments_multiples_selected.length?n.to_filter=!0:n.list_keys_values_segments_multiples_selected.length>0&&(n.to_filter=!0):n.to_filter=!0,p>0&&e.legends_field!==n.legends_field){var j=Object.values(e.active_legends)[0],O=Object.keys(e.active_legends)[0];j.filter(e=>""===e).length>0&&(j=e.chart_instance.legend.legendItems.filter(e=>!1===e.hidden).map(e=>e.text)),!1!==d.hasOwnProperty(O)||(d[O]=j.filter(e=>""!==e))}clean_filter_array(d),collect_active_legends_rmFilter(e,i,d);var x="remove_filter";if(clean_filter_array(d),Object.values(d).length>0||!0===n.to_filter)n.filtered_by={},K(e,n,d,x);else try{delete n.filtered_by.axis[e.category_field],delete n.filtered_by.axis[e.sub_category_field]}catch{}n.status_chart="",Object.assign(s,d)}for(var k=0;k<l.length;k++){var P=l[k],D=_.mapKeys(P.filtered_by.axis,function(e,t){return t}),I=Object.keys(D);I=I.filter(e=>""!==e);var w={};i.map(e=>{"leaflet"!==e.chart_type&&(w[e.legends_field]=e.chart_instance.legend.legendItems.filter(e=>""!==e.text&&!1===e.hidden).map(e=>e.text))});var E={},M=!1;if(V(D,w,E),!0===M)clean_filter_array(E),K(P,P,E,x="set_filter"),M=!1}if(E={},s={},V(e.filtered_by.axis,w,E),Object.assign(s,e.filtered_by.axis),clean_filter_array(s),Object.values(s).length>0){if("leaflet"===e.chart_type)return;K(e,e,e.filtered_by.axis,x);var C,F=e.chart_instance.config.type;r=0;C=void 0!==e.filtered_by.axis[e.legends_field]?e.filtered_by.axis[e.legends_field]:[],e.chart_instance.legend.legendItems.map(t=>{"doughnut"===F||"pie"===F?!(C.indexOf(t.text)>-1)||(e.chart_instance.getDatasetMeta(0).data[r].hidden=!1):!(C.indexOf(t.text)>-1)||(e.chart_instance.getDatasetMeta(r).hidden=!1),r++}),e.chart_instance.update(0)}function V(e,t,a){void 0!==e&&Object.keys(e).forEach(s=>{e[s].findIndex(e=>""===e)>-1&&(delete e[s],e[s]=t[s],Object.assign(a,e),M=!0)})}function K(e,t,a,s){var l={};Object.keys(a).forEach(e=>{""!==a[e][0]&&(l[e]=a[e])}),delete l[""],a=_.cloneDeep(l),t.transformations.crossfilter={},Object.assign(t.transformations.crossfilter,a),t.filtered_by={id:e.id,params_chart:e,axis:a};var i,r=t.instanciator.prepare_data_p1(t);if(i="leaflet"===t.chart_type?t.map_instance:t.chart_instance,t.data[0].labels=[],t.data[1].datasets=[],"leaflet"!==t.chart_type){i.config.data.labels=[];for(var n=0;n<i.config.data.datasets.length;n++)i.config.data.datasets[n].data=[],i.config.data.datasets[n].label="",i.config.data.datasets[n].backgroundColor=[],i.config.data.datasets[n].borderColor=[],i.config.data.datasets[n].borderWidth=[]}else t.data[1].markers=[],t.data[1].x_y=[],t.inject_type="update";if(0!==t.list_labels_segment_single_selected.length||0!==t.list_labels_segments_multiples_selected.length||Object.values(t.brush_values).length>0){t.prepare_data_type="preserve backgroundColor",t.instanciator.prepare_data_p2(r,t);var d="data",c="update";t.instanciator.inject_metadata(i,t,d,c),"leaflet"!==t.chart_type||t.instanciator.setup_legends(t,"update"),t.prepare_data_type=""}else{t.prepare_data_type="",t.instanciator.prepare_data_p2(r,t);d="data",c="update";t.instanciator.inject_metadata(i,t,d,c),"leaflet"!==t.chart_type||t.instanciator.setup_legends(t,"update")}}e.status_chart=""}}function extract_active_slices(e,t){var a=_.cloneDeep(e.list_labels_segments_multiples_selected);0===a.filter(e=>""!==e.category_field).length?(t[e.sub_category_field]=[],a.map(e=>delete e.category_field),a.map(a=>{t[e.sub_category_field].push(a.sub_category_field)})):0===a.filter(e=>""!==e.sub_category_field).length?(t[e.category_field]=[],a.map(e=>delete e.sub_category_field),a.map(a=>{t[e.category_field].push(a.category_field)})):(t[e.category_field]=[],t[e.sub_category_field]=[],a.map(a=>{t[e.category_field].push(a.category_field),t[e.sub_category_field].push(a.sub_category_field)}))}function get_active_legends(e,t,a,s){if(2===a.nb_axis)if(t.sub_category_field!==a.sub_category_field){var l=a.chart_instance.legend.legendItems.filter(e=>!1===e.hidden&&""!==e.text),i=_.map(l,e=>e.text);e[a.sub_category_field]=[];for(var r=0;r<i.length;r++)e[a.sub_category_field].push(i[r])}else Object.values(a.active_legends).length>0&&(e[a.sub_category_field]=a.active_legends[a.sub_category_field]);if(1===a.nb_axis)if("set_filter"===s){if(t.category_field===a.category_field){i=Object.values(a.active_legends)[0];e[a.category_field]=[];for(r=0;r<i.length;r++)e[a.category_field].push(i[r])}if(t.category_field!==a.category_field){i=Object.values(a.active_legends)[0];e[a.category_field]=[];for(r=0;r<i.length;r++)e[a.category_field].push(i[r])}}else if("remove_filter"===s){i=Object.values(a.active_legends)[0];e[a.category_field]=[];for(r=0;r<i.length;r++)e[a.category_field].push(i[r])}}function collect_active_legends_setFilter(e,t,a,s,l){a.filter(e=>"target"===e.status_chart)[0];for(var i=0;i<a.length;i++)if("target"!==a[i].status_chart){var r=a[i];if("selection_binding"===l||"multiple_selection_binding"===l||"legends_binding"===l){if(e.legends_field!==r.legends_field){if(Object.values(r.hidden_legends).length>0)var n=Object.values(r.hidden_legends)[0].length;else n=0;t.legends_field!==r.legends_field&&n>0&&_(s,r)}}else"brush_selection_binding"===l&&_(s,r)}function _(e,t){var a=t.hidden_legends;if(void 0!==a&&Object.values(a).length>0&&Object.values(a)[0].length>0){var s=Object.keys(a)[0];if(!1===e.hasOwnProperty(Object.keys(a)[0])){var l=Object.values(t.active_legends)[0];l.filter(e=>""===e).length>0&&(l=t.chart_instance.legend.legendItems.filter(e=>!1===e.hidden).map(e=>e.text)),e[s]=l}}}}function collect_active_legends_rmFilter(e,t,a){for(var s=t.filter(e=>"target"===e.status_chart)[0],l=0;l<t.length;l++)if("target"!==t[l].status_chart){var i=t[l];if(e.legends_field!==i.legends_field&&s.legends_field!==i.legends_field){var r=i.hidden_legends;if(void 0!==r&&Object.values(r).length>0&&Object.values(r)[0].length>0){var n=Object.keys(r)[0];if(!1===a.hasOwnProperty(Object.keys(r)[0])){var _=Object.values(i.active_legends)[0];_.filter(e=>""===e).length>0&&(_=i.chart_instance.legend.legendItems.filter(e=>!1===e.hidden).map(e=>e.text)),a[n]=_}}}}}function clean_filter_array(e){delete e[""],delete e[void 0],Object.keys(e).forEach(t=>void 0===e[t]?delete e[t]:{}),Object.keys(e).forEach(t=>e[t]===[void 0]?delete e[t]:{}),Object.keys(e).forEach(t=>""===e[t]?delete e[t]:{}),Object.keys(e).forEach(t=>""===e[t][0]?delete e[t]:{}),Object.keys(e).forEach(t=>0===e[t].length?delete e[t]:{})}function hide_legends(e,t){if(e.hidden_legends){if(void 0!==e.hidden_legends[e.category_field])var a=e.hidden_legends[e.category_field];else a=e.hidden_legends[e.sub_category_field];var s={};a&&a.map(t=>{var a=e.chart_instance.legend.legendItems.findIndex(e=>e.text===t);""!==t&&a>-1&&(s[t]=a)}),e.chart_instance.update();var l=e.chart_instance.config.type;if("set_filter"===t)if(Object.values(s).length>0)preserve_filtred_legends(e,s,l);else{var i=0;e.chart_instance.legend.legendItems.map(t=>{"doughnut"===l||"pie"===l?""===t.text||(e.chart_instance.getDatasetMeta(0).data[i].hidden=!1):""===t.text||(e.chart_instance.getDatasetMeta(i).hidden=!1),i++}),e.chart_instance.update()}else"remove_filter"===t&&preserve_filtred_legends(e,s,l)}}function sync_legends(e,t,a){if(e.legends_field===t.legends_field&&Object.values(e.hidden_legends).length>0){if(void 0!==e.hidden_legends[e.category_field])var s=e.hidden_legends[e.category_field],l=e.active_legends[e.category_field];else s=e.hidden_legends[e.sub_category_field],l=e.active_legends[e.sub_category_field];var i={};s&&s.map(e=>{var a=t.chart_instance.legend.legendItems.findIndex(t=>t.text===e);""!==e&&a>-1&&(i[e]=a)}),a.map(t=>t.legends_field===e.legends_field?t.hidden_legends[t.legends_field]=[]:{}),a.map(t=>t.legends_field===e.legends_field?t.active_legends[t.legends_field]=[]:{}),a.map(t=>t.legends_field===e.legends_field?s.map(e=>t.hidden_legends[t.legends_field].push(e)):{}),a.map(t=>t.legends_field===e.legends_field?l.map(e=>t.active_legends[t.legends_field].push(e)):{});var r=t.chart_instance.config.type;preserve_filtred_legends(t,i,r)}}function sync_legends_rm_filter(e,t){if(e.legends_field===t.legends_field&&Object.values(e.hidden_legends).length>0){if(void 0!==e.hidden_legends[e.category_field])var a=e.hidden_legends[e.category_field];else a=e.hidden_legends[e.sub_category_field];var s=[e,t];if(a.length>0){s.map(e=>{e.data=_.cloneDeep(e.data_source),e.prepare_data_type="";e.instanciator.inject_metadata(e.chart_instance,e,"data","update",0)});var l={};a&&a.map(e=>{var a=t.chart_instance.legend.legendItems.findIndex(t=>t.text===e);""!==e&&a>-1&&(l[e]=a)});var i=e.chart_instance.config.type;preserve_filtred_legends(e,l,i);i=t.chart_instance.config.type;preserve_filtred_legends(t,l,i),t.has_been_filtred=!0}}}function restore_original_chart_datasets(e){if(void 0!==e.hidden_legends[e.category_field])var t=e.hidden_legends[e.category_field];else t=e.hidden_legends[e.sub_category_field];e.data=_.cloneDeep(e.data_source),e.prepare_data_type="";e.instanciator.inject_metadata(e.chart_instance,e,"data","update",0);var a={};t&&t.map(t=>{var s=e.chart_instance.legend.legendItems.findIndex(e=>e.text===t);""!==t&&s>-1&&(a[t]=s)});var s=e.chart_instance.config.type;preserve_filtred_legends(e,a,s),e.has_been_filtred=!0}function preserve_filtred_legends(e,t,a){var s=Object.values(t),l=e.chart_instance.legend.legendItems.length;if(d3.sum(s)>=0)for(var i=0;i<l;i++)"doughnut"===a||"pie"===a?s.findIndex(e=>e===i)>-1?e.chart_instance.getDatasetMeta(0).data[i].hidden=!0:e.chart_instance.getDatasetMeta(0).data[i].hidden=!1:s.findIndex(e=>e===i)>-1?e.chart_instance.getDatasetMeta(i).hidden=!0:e.chart_instance.getDatasetMeta(i).hidden=!1;e.chart_instance.update(),Object.values(e.brush_values).length>0&&adapt_brush_v2(e)}function collect_active_legends(e,t,a){if(e.legend){for(var s=[],l=[],i=e.legend.legendItems.length,r=0;r<i;r++){var n=e.legend.legendItems[r].hidden;!1===n?s.push(e.legend.legendItems[r].text):!0===n&&l.push(e.legend.legendItems[r].text)}return t.legends_array=s,{active_legends:s,hidden_legends:l}}if("leaflet"===a.chart_type&&a.selected_legends.length>-1){for(s=[],l=[],i=a.selected_legends.length,r=0;r<i;r++)s=[...a.selected_legends];return t.legends_array=s,{active_legends:s,hidden_legends:l}}}